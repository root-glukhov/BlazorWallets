# BlazorWallets

![image](https://i.postimg.cc/mZPbnFQ3/2023-05-05-111852.png)

Перед запуском приложения, в консоли перейдите в папку `/src/Server` и вызовите команду `dotnet user-secrets set "RpcEndpoint" "Адрес вашей конечной точки RPC"`

Узнать подробнее про [Microsoft.Extensions.Configuration.UserSecrets](https://learn.microsoft.com/ru-ru/dotnet/api/microsoft.extensions.configuration.usersecrets)


## Архитектура и принцип работы
База данных используется SQLite. Обработка ошибок вынесена в отдельный middleware ExceptionInterceptor (В обработчике учтен лишь случай когда превышен лимит запросов к RPC узлу). 
Для запросов к блокчейну в серверной части приложения выделен отдельный DI сервис WalletService. Он имеет метод GetWalletsAsync где на вход принимает список объектов кошельков. Этот список объектов мы получаем из базы данных в контроллере, а затем передаем сервису. 

#### Алгоритм метода GetWalletsAsync работает следующим образом:

1. Устанавливается размер пакета batch size равным 1000 (максимальный размер batch запроса) и создается переменная index, которая будет использоваться для построения RPC-запросов.
2. Создается список задач batchTasks, который будет содержать все задачи для каждого пакета.
3. В цикле for итерируется через список кошельков, используя размер пакета как шаг. Для каждого пакета создается список кошельков batchWallets, который содержит кошельки для текущего пакета.
4. Создается новый RpcRequestResponseBatch для текущего пакета.
5. Для каждого кошелька в пакете batchWallets создается новый RpcRequestResponseBatchItem, который содержит RPC-запрос для получения баланса кошелька.
6. RpcRequestResponseBatchItem добавляется в текущий RpcRequestResponseBatch.
7. Создается новая задача, которая содержит асинхронный блок Task.Run, который выполняет отправку RPC-запроса и обработку ответа.
8. Задача добавляется в список batchTasks.
9. Выполняется метод Task.WhenAll, который ожидает завершения всех задач в списке batchTasks.
10. Список кошельков wallets возвращается, отсортированный по балансу в порядке убывания.

Среднее время выполнения запроса занимает 3 секунды.

